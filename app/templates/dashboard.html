{% extends "base.html" %}
{% block title %}Dashboard - {{ app_title }}{% endblock %}
{% block content %}
<h1>Dashboard</h1>
<div class="grid">
    <article>
        <header>Articles</header>
        <p><strong>{{ stats.total_articles }}</strong> total</p>
        <p>{{ stats.pending_articles }} pending &middot; {{ stats.fetched_articles }} fetched &middot; {{ stats.enriched_articles }} enriched</p>
        <footer><a href="/articles">Browse articles</a></footer>
    </article>
    <article>
        <header>Discovery</header>
        <p><strong>{{ stats.search_jobs }}</strong> active search jobs</p>
        <footer><a href="/search-jobs">Manage jobs</a></footer>
    </article>
    <article>
        <header>Knowledge</header>
        <p><strong>{{ stats.total_tags }}</strong> tags &middot; <strong>{{ stats.reading_lists }}</strong> reading lists</p>
        <p><strong>{{ stats.digests }}</strong> digests</p>
        <footer><a href="/interrogation">Ask a question</a></footer>
    </article>
</div>

{% if latest_digest %}
<article>
    <header>Latest Digest</header>
    <p><a href="/digests/{{ latest_digest.id }}"><strong>{{ latest_digest.title }}</strong></a></p>
    {% if latest_digest.period_start and latest_digest.period_end %}
    <p>{{ latest_digest.period_start.strftime('%b %d') }} &ndash; {{ latest_digest.period_end.strftime('%b %d, %Y') }} &middot; {{ latest_digest.article_count }} articles</p>
    {% endif %}
    <footer><a href="/digests">View all digests</a></footer>
</article>
{% endif %}

<h2>Recent Articles</h2>
{% if recent_articles %}
<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Source</th>
            <th>Status</th>
            <th>Added</th>
        </tr>
    </thead>
    <tbody>
        {% for a in recent_articles %}
        <tr>
            <td><a href="/articles/{{ a.id }}">{{ a.title }}</a></td>
            <td>{{ a.source }}</td>
            <td>
                {% if a.status == 'enriched' %}
                <mark>enriched</mark>
                {% elif a.status == 'fetched' %}
                <mark class="secondary">fetched</mark>
                {% elif a.status == 'pending' %}
                <span class="secondary">pending</span>
                {% elif a.status == 'fetch_failed' %}
                <span style="color: var(--pico-color-orange-500)">fetch failed</span>
                {% else %}
                {{ a.status }}
                {% endif %}
            </td>
            <td>{{ a.created_at.strftime('%Y-%m-%d') }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No articles yet. <a href="/articles/add">Add one manually</a> or <a href="/search-jobs">configure a search job</a>.</p>
{% endif %}
{% endblock %}
